!EvalModel
parameters: [Omega, sig_zz, b_xx, b_yy, b_zz, b_xy, b_yz, b_xz]
model: !Switch
  [Omega]: !LuaMap
        returns: [Omega]
        function: |
         function f (x)
           zStressDecreaseStart = -14000.;
           zStressDecreaseStop = -18000.;
           zStressDecreaseWidth = zStressDecreaseStart - zStressDecreaseStop;
           if (x["z"] >= zStressDecreaseStart) then
              Omega = 1.0
           elseif (x["z"] >= zStressDecreaseStop) then
              a = 1.0-(x["z"]-zStressDecreaseStop)/zStressDecreaseWidth;
              Sx = (3.0*a*a-2.0*a*a*a);
              Omega = 1.0-0.99*Sx;
           else
              Omega = 0.01;
           end
           return {
             Omega = Omega
           }
           end
  [b_xx, b_yy, b_zz, b_xy, b_yz, b_xz]: !EvalModel
    parameters: [sig_zz,S, SH_max]
    model: !Switch
      [sig_zz]: !Include Mw_78_Turkey_sig_zz.yaml
      [SH_max]: !Any
          components:
            - !GroupFilter
              groups: [1,66,67,68]
              components: !LayeredModel
                map: !AffineMap
                  matrix:
                    xy: [1.0, 1.0, 0.0]
                  translation:
                    xy: 0
                interpolation: linear
                parameters: [SH_max]
                nodes:
                    -1e10: [-20.0]
                    -85e3: [-20.0]
                    -25e3: [-10.0]
                    35e3: [15.0]
                    115e3: [15.0]
                    175e3: [25.0]
                    1e10: [25.0]
            - !GroupFilter
              groups: [65]
              components: !ConstantMap
                map:
                    SH_max:  -10.0
      [S]: !Any
          components:
            - !GroupFilter
              groups: [1,66,67,68]
              components: !LuaMap
                returns: [S]
                function: |
                 function f (x)
                  R = 0.55
                  return {
                    S = (1.0/R-1.0)
                  }
                  end
            - !GroupFilter
              groups: [65]
              components: !LuaMap
                returns: [S]
                function: |
                 function f (x)
                  R = 0.8
                  return {
                    S = (1.0/R-1.0)
                  }
                  end
    components: !AndersonianStress
      constants:
        mu_d:      0.2
        mu_s:      0.6
        cohesion:  0.0
        s2ratio: 0.75
        S_v: 2
  [sig_zz]: !Include Mw_78_Turkey_sig_zz.yaml
components: !LuaMap
  returns: [s_xx, s_yy, s_zz, s_xy, s_yz, s_xz]
  function: |
     function f (x)
      return {
        s_xx = x["Omega"] * x["b_xx"] + (1.0-x["Omega"]) * x["sig_zz"],
        s_yy = x["Omega"] * x["b_yy"] + (1.0-x["Omega"]) * x["sig_zz"],
        s_zz = x["Omega"] * x["b_zz"] + (1.0-x["Omega"]) * x["sig_zz"],
        s_xy = x["Omega"] * x["b_xy"],
        s_yz = x["Omega"] * x["b_yz"],
        s_xz = x["Omega"] * x["b_xz"]
      }
      end
